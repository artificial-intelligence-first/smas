{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["response_type", "status", "metadata"],
  "properties": {
    "response_type": {
      "type": "string",
      "enum": ["answer", "update_result", "validation_report", "analysis_report"]
    },
    "status": {
      "type": "string",
      "enum": ["success", "partial_success", "failure"]
    },
    "data": {
      "type": "object",
      "description": "Response data (varies by type)"
    },
    "answer": {
      "type": "object",
      "properties": {
        "question": {"type": "string"},
        "answer": {"type": "string"},
        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "file": {"type": "string"},
              "section": {"type": "string"},
              "relevance": {"type": "number", "minimum": 0, "maximum": 1}
            }
          }
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "update_result": {
      "type": "object",
      "properties": {
        "files_modified": {"type": "array", "items": {"type": "string"}},
        "pr_url": {"type": "string"},
        "commit_sha": {"type": "string"},
        "validation_passed": {"type": "boolean"}
      }
    },
    "validation_report": {
      "type": "object",
      "properties": {
        "total_files": {"type": "integer"},
        "errors": {"type": "array"},
        "warnings": {"type": "array"},
        "passed": {"type": "boolean"}
      }
    },
    "analysis_report": {
      "type": "object",
      "properties": {
        "type": {"type": "string"},
        "findings": {"type": "array"},
        "recommendations": {"type": "array"}
      }
    },
    "metadata": {
      "type": "object",
      "required": ["run_id", "timestamp"],
      "properties": {
        "run_id": {"type": "string"},
        "timestamp": {"type": "string", "format": "date-time"},
        "sags_invoked": {"type": "array", "items": {"type": "string"}},
        "duration_ms": {"type": "number"},
        "cost_estimate": {"type": "number"}
      }
    }
  }
}
